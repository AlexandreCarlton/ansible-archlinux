---

# TODO: Add mirrorlist, then update (unless below does that for us)

# Before we dive into other roles, update the distro to guarantee current packages
- name: Upgrade Arch Linux
  pacman:
    update_cache: yes
    upgrade: yes
  become: yes

- name: Give wheel group sudo (with password) privileges
  lineinfile:
    dest: /etc/sudoers
    line: "%wheel ALL=(ALL) ALL"
    state: present
    validate: 'visudo -cf %s'
  become: yes

- name: Set hostname to {{ system.hostname }}
  hostname: name={{ system.hostname }}
  become: yes

- name: Set timezone to {{ system.timezone }}
  timezone:
    name: "{{ system.timezone }}"
  become: yes

- name: Set locale to {{ system.locale }}
  locale_gen:
    name: "{{ system.locale }}"
    state: present
  become: yes

- include: dash.yml

- name: Install linux-zen kernel
  pacman:
    name: "{{ item }}"
  with_items:
    - linux-zen
    - linux-zen-headers
  become: yes

- name: Install mkinitcpio configuration
  template:
    src: etc/mkinitcpio.conf.j2
    dest: /etc/mkinitcpio.conf
  notify:
    - Create initial ramdisk environment
  become: yes

- name: Install pacman.conf
  file:
    path: etc/pacman.conf
    dest: /etc/pacman.conf
  become: yes

- name: Ensure folder for autologin override exists
  file:
    path: /etc/systemd/system/getty@tty1.service.d
    state: directory
  become: yes

- name: Enable autologin for user '{{ user.name }}'
  template:
    src: etc/systemd/system/getty@tty1.service.d/autologin.conf.j2
    dest: /etc/systemd/system/getty@tty1.service.d/autologin.conf
  become: yes

- name: Install sound utilities
  pacman:
    name: alsa-utils
  become: yes

- include: aura.yml
